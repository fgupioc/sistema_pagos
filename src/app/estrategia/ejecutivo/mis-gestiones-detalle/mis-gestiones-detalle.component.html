<div class="card">
  <div class="card-header">
    <h4>Información del crédito</h4>
  </div>
  <div class="card-body">
    <section *ngIf="credito && cartera && socio">
      <div class="row">
        <div class="col-12 col-md-3">
          <div class="form-group">
            <label>Cartera</label>
            <input type="text" class="form-control" [value]="cartera.nombre" disabled>
          </div>
        </div>
        <div class="col-12 col-md-5">
          <div class="form-group">
            <label>Cliente</label>
            <input type="text" class="form-control" [value]="credito.alias" disabled>
          </div>
        </div>
        <div class="col-12 col-md-2">
          <div class="form-group">
            <label>T. Documento</label>
            <input type="text" class="form-control" [value]="typeDocumentDescription" disabled>
          </div>
        </div>
        <div class="col-12 col-md-2">
          <div class="form-group">
            <label>N. Documento</label>
            <input type="text" class="form-control" [value]="documentNumber" disabled>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="form-group">
            <label>Etapa</label>
            <input type="text" class="form-control" [value]="regla" disabled>
          </div>
        </div>
        <div class="col-12 col-md-2">
          <div class="form-group">
            <label>N. Crédito</label>
            <input type="text" class="form-control" [value]="credito.nroCredito" disabled>
          </div>
        </div>
        <div class="col-12 col-md-2">
          <div class="form-group">
            <label>F. Vencimiento</label>
            <input type="text" class="form-control" [value]="funciones.formatDate(credito.fechaVencimiento, 'DD/MM/YYYY')" disabled>
          </div>
        </div>
        <div class="col-12 col-md-2">
          <div class="form-group">
            <label>Monto</label>
            <input type="text" class="form-control" [value]="credito.montoCredito" disabled>
          </div>
        </div>
      </div>
    </section>
    <section>
      <div class="row">
        <div class="col-12">
          <ngb-tabset [destroyOnHide]="false">
            <ngb-tab title="Gestión">
              <ng-template ngbTabContent>
                <section [formGroup]="form">
                  <div class="row other-btns mb-3">
                    <div class="col-12">
                      <a class="btn btn-social btn-instagram mr-4" (click)="showNewTask = true">
                        <i class="fa fa-bell-o"></i> Programar Tarea
                      </a>
                      <a class="btn btn-social btn-linkedin">
                        <i class="fa fa-envelope-o"></i> Enviar Correo
                      </a>
                    </div>
                    <div class="col-12">
                      <div class="container-works mt-2" *ngIf="showNewTask">
                        <ng-container >
                          <div class="row" [formGroup]="formTarea">
                          <div class="col-12">
                            <div class="form-group text-center">
                              <h4 class="font-weight-bold">Crear Tarea</h4>
                            </div>
                          </div>
                          <div class="col-12 col-md-6">
                            <div class="row">
                              <div class="col-12 col-md-6">
                                <div class="form-group">
                                  <label>Seleccione el tablero</label>
                                  <select class="form-control" formControlName="tableroTareaId">
                                    <option value="">Selecione</option>
                                    <option *ngFor="let item of misTableros" [value]="item.id">{{ item.nombre }}</option>
                                  </select>
                                </div>
                              </div>
                              <div class="col-12">
                                <div class="form-group">
                                  <label>Nombre</label>
                                  <input class="form-control" type="text" formControlName="nombre">
                                </div>
                              </div>
                              <div class="col-12 col-md-6">
                                <div class="form-group">
                                  <label>Prioridad</label>
                                  <select class="form-control" formControlName="prioridad">
                                    <option [value]="0">Baja</option>
                                    <option [value]="1">Media</option>
                                    <option [value]="2">Alta</option>
                                  </select>
                                </div>
                              </div>
                              <div class="col-12 col-md-6">
                                <div class="form-group">
                                  <label>Seleccione la actividad</label>
                                  <select class="form-control" formControlName="codActividad">
                                    <option value="">Selecione</option>
                                    <option *ngFor="let item of tipoActividades" [value]="item.codItem">{{ item.descripcion }}</option>
                                  </select>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-12 col-md-6">
                           <div class="row">
                             <div class="col-12">
                               <div class="form-group">
                                 <label>Fecha Vencimiento</label>
                                 <br>
                                 <input formControlName="fechaVencimiento" type="date" class="form-control input-date mr-2" style="width: 140px">
                                 <input formControlName="horaVencimiento" type="time" class="form-control input-date" style="width: 96px">
                               </div>
                             </div>
                             <div class="col-12 col-md-7">
                               <div class="form-group">
                                 <label class="container " style="font-size: 16px;">
                                   Recordar el
                                   <input type="checkbox" formControlName="checkFechaRecordatorio" (click)="changeRecordatorio($event)" >
                                   <span class="checkmark"></span>
                                 </label>

                                 <input formControlName="fechaRecordatorio" type="date" class="form-control input-date mr-2" (ngModelChange)="chengeFehcaRecordatorio($event)" style="width: 140px">
                                 <input formControlName="horaRecordatorio" type="time" class="form-control input-date" style="width: 96px">
                               </div>
                             </div>
                             <div class="col-12 col-md-5">
                               <div class="form-group">
                                 <label class="container" style="font-size: 16px;">
                                   Notificación SMS
                                   <input type="checkbox" formControlName="notificacion">
                                   <span class="checkmark"></span>
                                 </label>
                                 <label class="container" style="font-size: 16px;">
                                   Correo
                                   <input type="checkbox" formControlName="correo">
                                   <span class="checkmark"></span>
                                 </label>
                               </div>
                             </div>
                             <div class="col-12">
                               <div class="form-group">
                                 <label>Descripción</label>
                                 <textarea class="form-control" rows="2" formControlName="descripcion"></textarea>
                               </div>
                             </div>
                           </div>
                          </div>
                          <div class="col-12">
                            <div class="form-group text-center mt-2">
                              <button class="btn btn-sm btn-primary mr-2" [disabled]="formTarea.invalid" (click)="guardarTarea()">Guardar</button>
                              <button class="btn btn-sm btn-danger" (click)="formTarea.reset(); showNewTask = false;">Cancelar</button>
                            </div>
                          </div>
                        </div>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-12 col-md-6">
                      <div class="form-group">
                        <label>Tipo Gestión</label>
                        <select class="form-control" formControlName="tipoGestion">
                          <option *ngFor="let item of gestiones" [value]="item.codItem">{{ item.descripcion }}</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-12 col-md-6">
                      <label>Tipo Contacto</label>
                      <div class="input-group">
                        <select class="form-control" formControlName="tipoContacto">
                          <option *ngFor="let item of tiposContacto" [value]="item.codItem">{{ item.descripcion }}</option>
                        </select>
                        <div class="input-group-btn">
                          <button *ngIf="!showRespuesta" type="button" class="btn btn-info" (click)="iniciarGestion()">Iniciar</button>
                          <button *ngIf="showRespuesta" type="button" class="btn btn-danger" (click)="cancelarGestion()">Cancelar</button>
                        </div>
                      </div>
                    </div>
                    <ng-container *ngIf="form.controls.tipoContacto.value == '1' && showRespuesta">
                      <div class="col-12 col-md-4">
                        <label>Número telefonico</label>
                        <div class="input-group">
                          <select class="form-control" formControlName="telefono">
                            <option value="">Seleccione</option>
                            <option *ngFor="let item of showPhones" [value]="item.numero">{{ (item.codCiudad ? item.codCiudad + '-' : '') + item.numero }}</option>
                          </select>
                        </div>
                      </div>
                      <div class="col-12 col-md-4">
                        <div class="form-group">
                          <label>Tiempo(seg)</label>
                          <input Number class="form-control" placeholder="Tiempo transcurrido" formControlName="duracion">
                        </div>
                      </div>
                    </ng-container>
                    <ng-container *ngIf="form.controls.tipoContacto.value == '2' && showRespuesta">
                      <div class="col-12 col-md-6">
                        <div class="form-group">
                          <label>Seleccione Correo</label>
                          <select class="form-control" formControlName="correo">
                            <option value="">Seleccione</option>
                            <option *ngFor="let item of showEmails" [value]="item.email">{{ item.email }}</option>
                          </select>
                        </div>
                      </div>
                    </ng-container>
                    <ng-container *ngIf="form.controls.tipoContacto.value == '4' && showRespuesta">
                      <div class="col-12 col-md-6">
                        <div class="form-group">
                          <label>Seleccione Dirección</label>
                          <select class="form-control" formControlName="direccion">
                            <option value="">Selecione</option>
                            <option *ngFor="let item of showAddress" [value]="mostrarDireccion(item)">{{ mostrarDireccion(item)}}</option>
                          </select>
                        </div>
                      </div>
                    </ng-container>
                  </div>
                  <div class="row" *ngIf="showRespuesta">
                    <div class="col-12 col-md-4">
                      <div class="form-group">
                        <label>Respuesta</label>
                        <select class="form-control" formControlName="codRespuesta">
                          <option *ngFor="let item of respuestas" [value]="item.codItem">{{ item.descripcion }}</option>
                        </select>
                      </div>
                    </div>
                    <ng-container *ngIf="showAcuerdoPago">
                      <div class="col-12"></div>
                      <div class="col-12 col-md-4">
                        <ul class="list-group list-acuerdos">
                          <li class="list-group-item" [ngClass]="{'active': typeAcuerdo == 1}" (click)="typeAcuerdo = 1">AL DÍA</li>
                          <li class="list-group-item" [ngClass]="{'active': typeAcuerdo == 2}" (click)="typeAcuerdo = 2">PLAN DE PAGO</li>
                          <li class="list-group-item" [ngClass]="{'active': typeAcuerdo == 3}" (click)="typeAcuerdo = 3">TOTAL DE LA MORA</li>
                          <li class="list-group-item" [ngClass]="{'active': typeAcuerdo == 4}" (click)="typeAcuerdo = 4">ABONO</li>
                        </ul>
                      </div>
                      <ng-container *ngIf="typeAcuerdo == 1  || typeAcuerdo == 3 || typeAcuerdo == 4" [formGroup]="formRegistrarAcuerdo">
                        <div class="col-12 col-md-8">
                          <div class="row">
                            <div class="col-12" *ngIf="errors.length > 0">
                              <div class="form-group">
                                <div class="alert alert-danger" role="alert" *ngFor="let value of errors">
                                  <span><b>.</b> {{ value }}</span>
                                </div>
                              </div>
                            </div>
                            <div class="col-12 col-md-7">
                              <div class="form-group">
                                <label>Monto Acordado</label>
                                <input CustomizeCurrency type="text" class="form-control" formControlName="montoAcordado">
                              </div>
                            </div>
                            <div class="col-12 col-md-5">
                              <div class="form-group">
                                <label>Posibilidad Pagar</label>
                                <select class="form-control" formControlName="posibilidadPago">
                                  <option value="">Seleccione</option>
                                  <option value="1">Alto</option>
                                  <option value="2">Medio</option>
                                  <option value="3">Bajo</option>
                                </select>
                              </div>
                            </div>
                            <div class="col-12 col-md-7">
                              <div class="form-group">
                                <label>Fecha</label>
                                <input type="date" class="form-control" formControlName="fechaInicio">
                              </div>
                            </div>
                            <div class="col-12 col-md-5">
                              <div class="form-group">
                                <label>Hora</label>
                                <input type="time" class="form-control" min="07:00" max="20:00" formControlName="horaIncio">
                              </div>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                      <ng-container *ngIf="typeAcuerdo == 2" [formGroup]="formPlanPago">
                        <div class="col-12 col-md-8">
                          <div class="row">
                            <div class="col-12" *ngIf="errors.length > 0">
                              <div class="form-group">
                                <div class="alert alert-danger" role="alert" *ngFor="let value of errors">
                                  <span><b>.</b> {{ value }}</span>
                                </div>
                              </div>
                            </div>
                            <div class="col-12">
                              <div class="form-group">
                                <label>Nombre del plan</label>
                                <input SoloLetras Uppercase type="text" class="form-control" formControlName="descripcion">
                              </div>
                            </div>
                            <div class="col-12 col-md-6">
                              <div class="form-group">
                                <label>Número de cuotas</label>
                                <input Number type="text" class="form-control" formControlName="plazo">
                              </div>
                            </div>
                            <div class="col-12 col-md-6">
                              <div class="form-group">
                                <label>Valor de cuotas</label>
                                <input CustomizeCurrency type="text" class="form-control" formControlName="montoAcordado">
                              </div>
                            </div>
                            <div class="col-12 col-md-6">
                              <div class="form-group">
                                <label>Intervalo cotas (Días)</label>
                                <input Number type="text" class="form-control" formControlName="intervalo">
                              </div>
                            </div>
                            <div class="col-12 col-md-6">
                              <div class="form-group">
                                <label>Fecha inicio</label>
                                <input type="date" class="form-control" formControlName="fechaInicio">
                              </div>
                            </div>
                            <div class="col-12">
                              <div class="form-group">
                                <label>Posibilidad Pagar</label>
                                <select class="form-control" formControlName="posibilidadPago">
                                  <option value="">Seleccione</option>
                                  <option value="1">Alto</option>
                                  <option value="2">Medio</option>
                                  <option value="3">Bajo</option>
                                </select>
                              </div>
                            </div>
                          </div>
                        </div>
                      </ng-container>
                    </ng-container>
                    <div class="col-8">
                      <label>Comentario</label>
                      <div class="input-group">
                        <input type="text" class="form-control" formControlName="comentario">
                        <div class="input-group-btn">
                          <button [disabled]="form.invalid" type="button" class="btn btn-info" (click)="registrarGestion()">Ingresar</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>
                <div class="row">
                 <div class="col-12">
                   <div class="form-group">
                     <h6>Historial de Gestión</h6>
                   </div>
                 </div>
                  <div class="col-12">
                    <table class="table table-bordered" id="listaGestiones">
                      <thead>
                      <tr class="text-center">
                        <th scope="col">&nbsp;</th>
                        <th scope="col">Acción</th>
                        <th scope="col">Target</th>
                        <th scope="col">Respuesta</th>
                        <th scope="col">Comentario</th>
                        <th scope="col">Fecha</th>
                        <th scope="col">Ejecutivo</th>
                      </tr>
                      </thead>
                      <tbody>
                      <tr *ngFor="let item of acciones; let i = index">
                        <th scope="row">{{ i + 1 }}</th>
                        <td>{{ item.gestionDescripcion }}</td>
                        <td>{{ item.target }}</td>
                        <td>{{ item.respuestaDescripcion }}</td>
                        <td> {{item.comentario}}</td>
                        <td> {{item.fechaRegistro | date: 'd/M/yyyy'}}</td>
                        <td> {{item.ejecutivoNombre}}</td>
                      </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </ng-template>
            </ngb-tab>
            <ngb-tab>
              <ng-template ngbTabTitle>Pagos/Compromiso de Pagos</ng-template>
              <ng-template ngbTabContent>
                <div class="table-responsive">
                  <table id="tabla-acuerdos" class="table table-bordered table-hover">
                    <thead>
                    <tr class="text-center">
                      <th>Fecha</th>
                      <th>Monto</th>
                      <th>T. Acuerdo</th>
                      <th>Estado</th>
                      <th>Tipo</th>
                      <th>Cuota</th>
                      <th>Plazo</th>
                      <th>Opcipon</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr *ngFor="let item of acuerdosPago"  [class]="isCurrentDate(item.fechaInicio, item.condicion)" style="font-size: 12px; text-align: center">
                      <td>
                        {{ item.fechaInicio | date: 'dd/MM/yyyy' }}
                      </td>
                      <td>{{ item.montoAcordado  | currency: 'S/ ' }} </td>
                      <td>{{ getNameTipoAcuerdo(item.tipoAcuerdo) }}</td>
                      <td>{{ getNameCondition(item.condicion) | uppercase}}</td>
                      <td>{{ item.descripcion | uppercase}}</td>
                      <td>{{ item.cuota }}</td>
                      <td>{{ item.plazo }}</td>
                      <td>
                        <button *ngIf="conPermiso" [disabled]="isAfter(item.fechaInicio)" class="btn btn-sm btn-danger" (click)="eliminarAcuerdoPago(item)"><i class="fa fa-trash"></i></button>
                      </td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </ng-template>
            </ngb-tab>
            <ngb-tab title="Disabled">
              <ng-template ngbTabContent>
                <p>Sed commodo, leo at suscipit dictum, quam est porttitor sapien, eget sodales nibh elit id diam. Nulla facilisi. Donec egestas ligula vitae odio interdum aliquet. Duis lectus turpis, luctus eget tincidunt eu, congue et odio. Duis pharetra et nisl at faucibus. Quisque luctus pulvinar arcu, et molestie lectus ultrices et. Sed diam urna, egestas ut ipsum vel, volutpat volutpat neque. Praesent fringilla tortor arcu. Vivamus faucibus nisl enim, nec tristique ipsum euismod facilisis. Morbi ut bibendum est, eu tincidunt odio. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Mauris aliquet odio ac lorem aliquet ultricies in eget neque. Phasellus nec tortor vel tellus pulvinar feugiat.</p>
              </ng-template>
            </ngb-tab>
          </ngb-tabset>
        </div>
      </div>
    </section>
  </div>
</div>
